# This playbook is running from the bridge (nested in zuul job)
---
- hosts: bridge.softwarefactory-project.io
  gather_facts: yes
  module_defaults:
    group/os:
      cloud: vexxhost-rdo
  vars:
    tenants:
      - infra-rdo
      - infra-sf
      - nodepool-sf
  tasks:
    - set_fact:
        servers_ip: []

    - include_tasks: tasks/create-hosts.yaml
      loop: "{{ tenants }}"
      loop_control:
        loop_var: tenant

    - name: Show servers ip
      debug:
        msg: "{{ servers_ip | to_yaml }}"

    - name: Dump servers ip
      become: true
      copy:
        content: |
          # This file is generated by the create-hosts playbook
          # And it is used to update the /etc/hosts by the generate-etc-hosts role
          {{ ({ 'inventory_hosts_ip' : servers_ip }) | to_yaml }}
        dest: "/etc/hosts.yaml"
