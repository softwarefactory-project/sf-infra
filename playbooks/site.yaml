---
- hosts: bridge
  gather_facts: yes
  pre_tasks:
    - name: Ensure hostname is correct
      hostname:
        name: bridge.softwarefactory-project.io
      become: yes
  roles:
    - bridge-accounts
    - postfix
    - node-exporter

- hosts: backup
  roles:
    - node-exporter-rpm

- hosts: afs-mirror
  roles:
    - afs-mirror
    - node-exporter-rpm

- hosts: logreduce-mqtt
  roles:
    - node-exporter
    - custom-exporter
    - logreduce-mqtt-worker

- hosts: prometheus
  pre_tasks:
    - name: Install requirements
      package:
        name:
          - podman
          - dnsmasq
      become: yes
  roles:
    - alert-manager
    - dnsmasq
    - grafana
    - node-exporter
    - blackbox-exporter
    - prometheus

- hosts: dlrn
  roles:
    - node-exporter-rpm
