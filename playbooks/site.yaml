---
- hosts: bridge.softwarefactory-project.io
  gather_facts: yes
  pre_tasks:
    - name: Ensure hostname is correct
      hostname:
        name: bridge.softwarefactory-project.io
      become: yes
  roles:
    - bridge-accounts
    - generate-etc-hosts
    - postfix

- hosts: all
  roles:
    - node-exporter

- hosts: backup
  roles:
    - backup-monitoring

- hosts: afs-mirror
  roles:
    - afs-mirror
    - afs-monitoring

- hosts: logreduce-mqtt
  roles:
    - custom-exporter
    - logreduce-mqtt-worker

# Temporary group until the migration is completed
- hosts: rdocloud-data-fetcher
  roles:
    - setup-rdocloud-ssh-access

- hosts: sf
  roles:
    - sf-ssh

- hosts: install-server-sf
  roles:
    - sf-install-server

- hosts: integrations.softwarefactory-project.io
  roles:
    - integrations

- hosts: prometheus.monitoring.softwarefactory-project.io
  pre_tasks:
    - name: Install requirements
      package:
        name:
          - podman
          - dnsmasq
      become: yes
  roles:
    - hostname
    - setup-ssl
    - monitoring-gateway
    - alert-manager
    - dnsmasq
    - grafana
    - blackbox-exporter
    - prometheus

- hosts: dlrn
  roles:
    - firewalld

- hosts: trunk.rdoproject.org
  roles:
    - rdotrunk-checks

- hosts: trunk-centos7.rdoproject.org
  vars_files:
    - vars/dlrn.yaml
  roles:
    - swap
    - dlrn-server

- hosts: trunk-centos8.rdoproject.org
  vars_files:
    - vars/dlrn.yaml
  roles:
    - dlrn-server

- hosts: centos8-rpm-packaging-ci.rdoproject.org
  roles:
    - swap
    - dlrn-server

- hosts: logserver.rdoproject.org
  roles:
    - hostname
    - volume
    - logserver
    - setup-ssl

- hosts: images.rdoproject.org
  roles:
    - hostname
    - volume
    - setup-ssl
    - {role: image-server, become: true}

- hosts: redhat-oss-git-stats.softwarefactory-project.io
  roles:
    - hostname
    - elasticsearch
    - repoxplorer
    - repoxplorer-gateway
    - repoxplorer-rh-config
    - setup-ssl

- hosts: www.rdoproject.org
  roles:
    - hostname

- hosts: elk.softwarefactory-project.io:nodepool-builder.softwarefactory-project.io
  roles:
    - volume

- hosts: dlrn-db.rdoproject.org
  vars_files:
    - vars/dlrn-db.yaml
  roles:
    - hostname
    - firewalld
  tasks:
    - include_role:
        name: mariadb-replicated
        tasks_from: master.yml
