---
- hosts: bridge.softwarefactory-project.io
  gather_facts: yes
  pre_tasks:
    - name: Ensure hostname is correct
      ansible.builtin.hostname:
        name: bridge.softwarefactory-project.io
      become: yes

  roles:
    - service/manage-accounts
    - system/generate-etc-hosts
    - service/node-exporter
    - system/update-host

  tasks:
    - name: "Install MTA"
      ansible.builtin.include_role:
        name: postfix
        apply:
          become: yes
      vars:
        myhostname: "{{ smtp_host }}"
        mydomain: "{{ smtp_domain }}"
        myorigin: "{{ smtp_host }}"
        mynetworks:
          - "{{ prometheus_public_ip }}/32"
