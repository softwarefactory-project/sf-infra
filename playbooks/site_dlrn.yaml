---
- import_playbook: site_bridge.yaml

- hosts: dlrn:!dlrn-db.rdoproject.org
  vars_files:
    - vars/dlrn.yaml
  roles:
    - service/firewalld
    - infra-dlrn/dlrn-server

- hosts: trunk.rdoproject.org
  roles:
    - service/apache-exporter

- hosts:
    - trunk-centos7.rdoproject.org
    - trunk-centos8.rdoproject.org
    - centos8-rpm-packaging-ci.rdoproject.org
  roles:
    - system/swap

- hosts: dlrn-db.rdoproject.org
  vars_files:
    - vars/dlrn-db.yaml
  roles:
    - service/firewalld
    - service/hostname
    - service/mysqld-exporter
  tasks:
    - include_role:
        name: infra-dlrn/mariadb-replicated
        tasks_from: master.yml


# NOTE: Appling this play on a working slave breaks replication, commenting until
#       we investigate how to properly setup slave
# # for mysql replication, according to roles/dlrn/mariadb-replicated/README.md
# # master and replica should be in the same playbook
# - hosts: backup-server
#   vars_files:
#     - vars/dlrn-db.yaml
#   roles:
#     - service/mysqld-exporter
#   tasks:
#     - include_role:
#         name: dlrn/mariadb-replicated
#         tasks_from: replica.yml
