- name: Include tenant configuration
  include_vars:
    file: "{{ cloud.tenant | default(cloud.name) }}.yaml"
    name: tenant_config

- name: Provision keypairs
  os_keypair:
    cloud: "{{ cloud.name }}"
    auth:
      project_name: "{{ cloud.tenant | default(omit) }}"
    state: "replace"
    name: "{{ item.name }}"
    public_key: "{{ item.public_key }}"
  loop: "{{ tenant_config.keypairs }}"

- name: Configure tenant networks
  include_role:
    name: service/manage-networking

- name: Configure images
  include_role:
    name: service/manage-image
  loop: "{{ tenant_config.images }}"
  loop_control:
    loop_var: image
