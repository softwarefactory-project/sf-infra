# Code generated by dhall-to-yaml.  DO NOT EDIT.
groups:
  - name: secrets.rules
    rules:
      - alert: SecretWillExpireInTwoWeeks
        annotations:
          description: "To update the secret:\n\n- k1s_token: Use `uuidgen`.\n- k1s_key, k1s_crt and k1s_chain: Create a new certifcate.\n\nAfter merging the sf-infra change, make sure to restart nodepool-launcher service to update the client.\n\n\nSee the ansible-vault documentation to perform the actual update."
          summary: "Secret {{ $labels.target }} will expire in two weeks"
        expr: "(time() - sf_infra_secret_age_total{name=~'k1s_.*'}) > (63072000 - 1209600)"
        labels:
          severity: warning
      - alert: SecretWillExpireInTwoWeeks
        annotations:
          description: "To update the secret use `uuidgen`.\n\n\nSee the ansible-vault documentation to perform the actual update."
          summary: "Secret {{ $labels.target }} will expire in two weeks"
        expr: "(time() - sf_infra_secret_age_total{name=~'grafana_pass'}) > (63072000 - 1209600)"
        labels:
          severity: warning
      - alert: SecretWillExpireInTwoWeeks
        annotations:
          description: "You need to connect as the zuul user on both pages (see password in bitwarden) and renew the API keys there.\nRestart Zuul with the updated config once the keys have been regenerated.\n\n\nSee the ansible-vault documentation to perform the actual update."
          summary: "Secret {{ $labels.target }} will expire in two weeks"
        expr: "(time() - sf_infra_secret_age_total{name=~'zuul_pagure_token_.*'}) > (15552000 - 1209600)"
        labels:
          severity: warning
      - alert: SecretWillExpireInTwoWeeks
        annotations:
          description: "You need to connect as softwarefactoryio-zuul-bot on gitlab.com (see password in bitwarden) and renew a personal access token.\nMake sure you choose an expiry date of a year when creating the token.\n\n\nSee the ansible-vault documentation to perform the actual update."
          summary: "Secret {{ $labels.target }} will expire in two weeks"
        expr: "(time() - sf_infra_secret_age_total{name=~'zuul_gitlab_com_connection_api_token'}) > (31536000 - 1209600)"
        labels:
          severity: warning
      - alert: SecretWillExpireInTwoWeeks
        annotations:
          description: "Unknown secret expired. Please rotate and add instructions to monitoring/rules-secrets.dhall\n\n\nSee the ansible-vault documentation to perform the actual update."
          summary: "Secret {{ $labels.target }} will expire in two weeks"
        expr: "(time() - sf_infra_secret_age_total{name=~'cloud_softwarefactory_service_account_token|tenant_builds_zuul_api_url_es_password|tenant_builds_zuul_api_url_es_password|internal_users_admin_password|internal_users_kibanaserver_password|users_admin_password|users_logstash_password|users_curator_password|users_zuul_password|users_admin_password|users_logstash_password|users_curator_password|users_zuul_password|clair_psk_key|postgresql_user|postgresql_password|postgresql_admin_password|redis_password|database_secret_key|secret_key|quay_users_admin_password|quay_users_admin_token|quay_users_sf_password|quay_users_tripleo_password|quay_users_tripleo_token|quay_users_zuul_password|quay_organizations_tripleo_tripleomastercentos9_token|quay_organizations_tripleo_tripleowallabycentos9_token|quay_organizations_tripleo_tripleozedcentos9_token|quay_organizations_tripleo_openstack-k8s-operators_token|quay_organizations_tripleo_podified-main-centos9_token|quay_organizations_tripleo_podified-master-centos9_token|quay_organizations_tripleo_podified-zed-centos9_token|quay_organizations_tripleo_podified-antelope-centos9_token|quay_organizations_tripleo_podified-master-centos10_token|install_server_sf_key|install_server_rdo_key|rhel_activationkey|rhel_org_id|rhel_pool_ids|loki_auth_config_gateway_password|sf_grafana_password|vexxhost_prometheus_password|vexxhost_prometheus_url|vexxhost_prometheus_user|nextgen_openshift_prometheus_url|vexxhost_ceph_s3_access|vexxhost_ceph_s3_secret|gateway_password|vexxhost_nodepool_rdo_password|ibm_bm3_password|ibm_bm3_url|ibm_bm4_password|ibm_bm4_url|zuul_github_com_connection_webhook_token|zuul_github_com_connection_app_key|zuul_github_com_connection_api_token|zuul_gitlab_com_connection_webhook_token|centOSInfra_zuul_ssh_priv'}) > (63072000 - 1209600)"
        labels:
          severity: warning
