---
- name: Create host directories
  become: yes
  file:
    path: /etc/alertmanager
    state: directory

- name: Create configuration file
  become: yes
  copy:
    content: |
      ---
      global:
        resolve_timeout: 5m
        smtp_smarthost: 'bridge.softwarefactory-project.io'
        smtp_from: 'prometheus@bridge.softwarefactory-project.io'
      route:
        group_by: [Alertname]
        receiver: softwarefactory-operations-team

      receivers:
        - name: softwarefactory-operations-team
          email_configs:
            - to: softwarefactory-operations-team@redhat.com

    dest: /etc/alertmanager/alertmanager.yml
  register: _am_config

- include_role:
    name: container-service
  vars:
    pod_name: alertmanager
    pod_param: -p 9093:9093 -v /etc/alertmanager/alertmanager.yml:/etc/alertmanager/alertmanager.yml quay.io/prometheus/alertmanager
    pod_config: "{{ _am_config }}"
