---
- name: Stop old services
  become: true
  service:
    name: "{{ item }}"
    state: stopped
  loop:
    - "log-gearman-worker"
    - "log-gearman-client"
    - "zuul-job-scrapper-{{ external_elk['infra_name'] }}"

- name: Remove old log gearman services and zuul log scrapper
  become: true
  file:
    path: "{{ item }}"
    state: absent
  loop:
    - "/etc/log-gearman-client/config-{{ external_elk['infra_name'] }}.yml"
    - "/etc/log-gearman-worker/config-{{ external_elk['infra_name'] }}.yml"
    - "/usr/lib/systemd/system/log-gearman-client-{{ external_elk['infra_name'] }}.service"
    - "/usr/lib/systemd/system/log-gearman-worker-{{ external_elk['infra_name'] }}.service"
    - "/usr/lib/systemd/system/zuul-job-scrapper-{{ external_elk['infra_name'] }}.service"
    - "/etc/logrotate.d/log-gearman-client-{{ external_elk['infra_name'] }}"
    - "/etc/logrotate.d/log-gearman-worker-{{ external_elk['infra_name'] }}"
    - "/usr/local/bin/zuul-job-scrapper.py"

- name: Create tripleo cronjob entry
  become: true
  cron:
    name: Forward tripleo openstack jobs
    state: absent

- name: Remove tripleo cronjob entry if absent
  become: true
  cron:
    name: Forward tripleo openstack jobs
    state: absent
