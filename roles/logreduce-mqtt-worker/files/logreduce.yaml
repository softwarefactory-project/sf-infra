logging:
  loggers:
    logreduce:
      handlers: ['file', 'console']
      level: INFO
      propagate: 0
    gear:
      handlers: ['file', 'console']
      level: WARN
      propagate: 0
    sqlalchemy.engine:
      handlers: ['file', 'console']
      level: WARN
      propagate: 0
  handlers:
    console:
      class: logging.StreamHandler
      formatter: console
      level: INFO
      stream: ext://sys.stdout
    file:
      class: logging.handlers.TimedRotatingFileHandler
      formatter: file
      level: DEBUG
      filename: '/var/log/logreduce/{service}.log'
      when: 'midnight'
      interval: 1
      backupCount: 30
  formatters:
    file:
      format: '%(asctime)s %(levelname)s %(name)s: %(message)s'
    console:
      format: '%(levelname)7s %(name)s: %(message)s'
  root:
    handlers: ['file', 'console']
    level: INFO

server:
  zuul_url: https://softwarefactory-project.io/zuul/api/tenant/rdoproject.org
  models_folder: /var/lib/logreduce/models
  logserver_folder: /var/lib/logreduce/logs
mqtt:
  url: softwarefactory-project.io
  tenants:
    - rdoproject.org
  jobs:
    - ^tripleo-ci-centos-7-ovb-3ctlr_1comp.*$
  model_dest: uploader@logs.rdoproject.org:/var/www/html/review.rdoproject.org/classifiers
  log_dest: uploader@logs.rdoproject.org:/var/www/html/review.rdoproject.org
  rsync: True
filters:
  # '\' needs to be escaped twice because of YAML pre-processing
  # To test the regexp, use this snippet:
  # import sys, re, yaml
  # re.compile(r'|'.join(yaml.safe_load(open('logreduce.yaml'))['filters']['exclude_lines'])).match(sys.argv[1])
  exclude_lines:
    # Zuul console log message
    - "^[0-9:\\. -]+.* \\| primary \\| ZUUL_.*=.*$"
    # podman ps list
    - "^[0-9 ]*[a-zA-Z0-9]+\\s+[0-9]+\\s+[0-9]+\\s+[0-9\\.]+\\s+[0-9].*$"
    # podman pid user pr
    - "^\\s+[0-9]+\\s+[a-z]+\\s+[0-9]+$"
    # netstat
    - "^unix\\s+2\\s+.*STREAM\\s+LISTENING"
    # neutron dhcp interface
    - "^tap[^ ]*$"
    # keepalived
    - "^\\s*MAC = [a-z0-9:]{17}$"
    # cinder-volumes ids
    - "^\\s*id = \"[a-zA-Z0-9\\-]{38}\"$"
    # Docker id
    - "^ID. [^ ]+$"
    # Layer dumps
    - "^    .layers.: .$|^            .mediaType.: .application/vnd.docker.image.rootfs.diff.tar.gzip., $|^            .digest.: .sha256:.*$"
    # Deployment ids
    - "^\\s*[a-zA-Z0-9]{25}$"
    # Galera ids
    - "^\\s*[a-z0-9]{8},[0-9]$"
    # pcsd log
    - "^[a-z0-9:]{45}$"
    - "^[a-z0-9:]{54}$"
    # auth token
    - "^OS_AUTH_TOKEN="
    - "^password="
    - ".*OS_PASSWORD=[a-zA-Z0-9]+\\\"?,?$"
    # docker stats
    - "^[a-z0-9]{12} .*[0-9\\.]+ *[a-zA-Z]*B / [0-9\\.]+ *[a-zA-Z]*B .* [0-9]+$"
    # kola id
    - "^\\+\\+ echo [a-zA-Z0-9]{20}$"
    # ironic system log base64 encoded
    - "^.* DEBUG .* Agent command log.collect_system_logs for node .* returned result .u'system_logs'. u'"
    # memcache stdout
    - "^>[0-9]+ sending key [^ ]+$"
    - "^[^ ]+>[0-9]+ sending key"
    - "^[^ ]+$"
    # cloud init ips
    - "^.*\\^[+*?-].*\\s+[0-9]+\\s+[0-9]+\\s+[0-9]+\\s+.*\\+\\/\\-\\s+[0-9]+[mun]s$"
    # IPA base64
    - "^[^ ]+=$"
    # IPA cookies
    - "^.*[Cc]ookie.*ipa_session="
    - "^[0-9]+.sig-ipa.ooo.test"
    - "^ipa\\.ooo\\.test\\."
  exclude_files:
    - "deployment-hieradata.j2.yaml"
    - "tempest.html"
    - "rabbitmq.config"
    - "influxdb_data"
    - "haproxy-stats.txt"
    - "named.keytab"
    - "yum.log"
  exclude_paths:
    - "group_vars/Compute"
    - "group_vars/Controller"
    - "group_vars/Undercloud"
    - "logs/quickstart_collect_logs.log"
    - "etc/openstack-dashboard/local_settings"
    - "etc/iscsi/initiatorname.iscsi"
    - "var/log/extra/podman/podman_allinfo.log"
    - "etc/ipa/"
    - "home/zuul/undercloud-install-"
    - "var/log/pki/pki-ca-spawn"
    - "ipa/master/ooo.test"
    - "pki/pki-tomcat/ca/debug"
    - "var/log/extra/network-bridges"
    - "logs/delorean_logs/"
