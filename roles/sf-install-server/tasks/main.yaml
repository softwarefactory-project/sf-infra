---
- name: Authorized backup node to run backup
  become: yes
  authorized_key:
    user: root
    key: "{{ backup_pub_key }}"

- name: Copy install-server ssh key
  become: yes
  copy:
    content: "{{ sf_ssh_priv_key }}"
    dest: /root/.ssh/id_rsa
    mode: 0400
  when: not sf_tenant

- name: Install last stable repository of software factory
  become: true
  package:
    name: https://softwarefactory-project.io/repos/sf-release-{{ sf_version }}.rpm
  # quick fix because sf-release doesn't install when repo
  ignore_errors: true

- name: Copy the arch.yaml
  become: true
  copy:
    src: "arch-{{ ansible_fqdn }}.yaml"
    dest: /etc/software-factory/arch.yaml

# good-to-have (or even glacier task):
  # Copy content arch.yaml
  # Template sfconfig.yaml using vault variable for secret
  # Copy github pem, clouds.yaml, ...

  # Indicate here how to restore a backup if needed

  # sf-config
