---
- name: Copy install-server ssh key
  become: yes
  copy:
    content: "{{ sf_ssh_priv_key }}"
    dest: /root/.ssh/id_rsa
    mode: 0400
  when: not sf_tenant

- name: Install last stable repository of software factory
  become: true
  package:
    name: https://softwarefactory-project.io/repos/sf-release-{{ sf_version }}.rpm

- name: Install sfconfig package
  become: true
  package:
    name: https://softwarefactory-project.io/logs/85/17685/3/check/sf-rpm-build/8d1d2d6/buildset/sf-config-3.5.0.14.gef78449-3.el7.noarch.rpm

- name: Copy the arch.yaml
  become: true
  copy:
    src: "arch-{{ ansible_fqdn }}.yaml"
    dest: /etc/software-factory/arch.yaml

# good-to-have (or even glacier task):
  # Copy content arch.yaml
  # Template sfconfig.yaml using vault variable for secret
  # Copy github pem, clouds.yaml, ...

  # Indicate here how to restore a backup if needed

  # sf-config
