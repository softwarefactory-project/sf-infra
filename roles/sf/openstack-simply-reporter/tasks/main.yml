---
- name: Setup virtual env on Centos 8
  yum:
    name: python3-openstacksdk
  become: true

- name: Copy openstack simply reporter
  copy:
    src: openstack-simply-reporter.py
    dest: /usr/local/bin/openstack-simply-reporter.py
    mode: "0755"
  become: true

# NOTE: Only root has clouds information
- name: Create cronjob
  become: true
  become_user: root
  cron:
    name: Get stack status
    minute: "*/5"
    job: "/usr/local/bin/openstack-simply-reporter.py --os-clouds {{ os_clouds | join(' ') }} > /dev/null"
