- name: 'Delete existing partition of {{ item }}'
  parted:
    device: '{{ item }}'
    number: '{{ part_number }}'
    state: absent
  register: _partitions_deleted
  when: delete_partitions | bool

- name: "Check if device {{ item }} is part of the lv"
  command: "pvck -q {{ item }}"
  register: _pvck
  changed_when: false
  failed_when: _pvck.rc not in [0, 1]

- name: 'Wipe partition table of {{ item }}'
  command: 'wipefs -a {{ item }}'
  when:
    - (_partitions_deleted.changed | bool) or (_pvck.stderr != "")
    - wipe_partition_table | bool
