---
- name: Configure swap
  become: true
  block:
    - name: Format swap
      community.general.filesystem:
        fstype: swap
        dev: "{{ swap_device }}"

    - name: Add swap to fstab
      ansible.builtin.mount:
        fstype: swap
        path: swap
        src: "{{ swap_device }}"
        state: present
        opts: defaults
      register: swap_fstab

    - name: Activate swap
      ansible.builtin.command: swapon -a
      when:
        - swap_fstab.changed
        - ansible_connection != 'podman'
