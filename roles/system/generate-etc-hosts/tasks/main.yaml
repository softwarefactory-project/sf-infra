- include_vars:
    file: /etc/hosts.yaml

- name: Create /etc/hosts
  copy:
    content: |
      127.0.0.1   localhost {{ ansible_hostname }} {{ inventory_hostname }}
      ::1         localhost {{ ansible_hostname }} {{ inventory_hostname }}

      {% for host in inventory_hosts_ip %}{%
        if (ansible_host == 'prometheus.monitoring.softwarefactory-project.io' and host.name not in inventory_public_dns)
        or (ansible_host != 'prometheus.monitoring.softwarefactory-project.io') %}
      {% if 'floating_ip' in host and host.floating_ip %}
      {{ host.floating_ip }} {{ host.name }}
      {% else %}
      {{ host.ip }} {{ host.name }}
      {% endif %}
      {% endif %}{% endfor %}
    dest: /etc/hosts
  become: yes

- name: Setup ssh config
  become: yes
  copy:
    src: sshconfig
    mode: 0400
    owner: "{{ item.owner }}"
    dest: "{{ item.home }}/.ssh/config"
  loop:
    - home: /home/fedora
      owner: fedora
    - home: /root
      owner: root
  when: manage_ssh_config
