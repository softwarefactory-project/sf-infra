# This file is managed by dhall.
groups:
  - name: node.rules
    rules:
      - alert: InstanceDown
        expr: "up{job=\"node\"} == 0"
        for: 10m
      - alert: WillRunOutOfDiskInThreeDays
        annotations:
          description: "Disk is almost full (< 10% left)\n  VALUE = {{ $value }}\n  LABELS: {{ $labels }}"
          summary: "Out of disk space (instance {{ $labels.instance }})"
        expr: "(node_filesystem_avail_bytes{job=\"node\"} * 100 / node_filesystem_size_bytes{job=\"node\"} < 50) and (predict_linear(node_filesystem_avail_bytes{job=\"node\"}[1d], 3 * 24 * 3600) < 0)"
        for: 1h
      - alert: WillRunOutOfMemoryInThreeDays
        annotations:
          description: |
            Node memory is filling up (< 10% left)
              VALUE = {{ $value }}
              LABELS: {{ $labels }}
          summary: "Out of memory (instance {{ $labels.instance }})"
        expr: "(node_memory_MemAvailable_bytes * 100 / node_memory_MemTotal_bytes < 50) and (predict_linear(node_memory_MemAvailable_bytes{job=\"node\"}[1d], 3 * 24 * 3600) < 0)"
        for: 12h
      - alert: InstanceOutOfMemory
        annotations:
          description: |
            Node only has {{ $value }} bytes of free mem available.
          summary: "Out of memory (instance {{ $labels.instance }})"
        expr: "node_memory_MemAvailable_bytes < (1024 * 1024 * 10)"
        for: 30m
