---
- name: check for tls cert
  become: yes
  stat:
    path: "{{ le_base_path }}/{{ fqdn }}/cert.pem"
  register: _tls_cert

- name: setup vhost
  template:
    src: vhost.j2
    dest: /etc/httpd/conf.d/logserver.vhost.conf
  become: yes

- name: Create logs directory
  file:
    path: /var/www/logs
    state: directory
    owner: loguser
    group: apache
    mode: 0755

- name: Install purge-logs script
  become: yes
  template:
    src: purge-logs.sh.j2
    dest: /usr/local/bin/purge-logs.sh
    mode: 0755

- name: Install crontab for purge-logs
  become: yes
  cron:
    name: purge-logs
    user: loguser
    job: /usr/local/bin/purge-logs.sh
    hour: 5
    minute: 0
