---
- name: Authorize install-server ssh access
  become: yes
  authorized_key:
    user: root
    key: "{{ sf_ssh_pub_key }}"
  # added to mitigate MODULE FAILURE when
  # deploying keys on sf hosts
  ignore_errors: true
  when: ansible_fqdn != "managesf.softwarefactory-project.io"

- name: Add ssh config to reach imb instances without fip
  become: yes
  blockinfile:
    path: /root/.ssh/config
    marker: "# {mark} ANSIBLE MANAGED BLOCK private network baremetal02"
    block: |
      Host 192.168.25.*
          ProxyJump baremetal02.rdoproject.org

      Host baremetal02.rdoproject.org
          User root
          Port 22
          Hostname 169.60.49.233

      Host ibm-nodepool-launcher*
          ProxyJump baremetal02.rdoproject.org
          Hostname 192.168.25.195

      Host ibm-ze*
          ProxyJump baremetal02.rdoproject.org
          Hostname 192.168.25.127

      Host ibm-zfgw*
          ProxyJump baremetal02.rdoproject.org
          Hostname 192.168.25.80
  when: ansible_fqdn == "managesf.softwarefactory-project.io"
