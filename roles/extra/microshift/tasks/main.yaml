---
- name: Check if pull-secret is provided when copr version is disabled
  fail:
    msg: "You need to provide pull-secret.txt content into the var!"
  when: openshift_pull_secret == '' and not use_copr_microshift

- name: Disable selinux
  include_tasks: selinux.yaml
  when: disable_selinux

- name: Setup Microshift repository
  include_tasks: repo.yaml

- name: Prepare host
  include_tasks: pre.yaml

- name: Disable swap
  include_tasks: swap.yaml

- name: Setup tools
  include_tasks: tools.yaml
  when: setup_tools

- name: Prepare cri-o
  include_tasks: crio.yaml

- name: Prepare firewall
  include_tasks: firewall.yaml

- name: Setup Microshift
  include_tasks: microshift.yaml

- name: Provide credentials for restricted regitries
  include_tasks: registry_login.yaml
  when: not use_copr_microshift

- name: Setup OLM
  include_tasks: olm.yaml
  when: setup_olm

- name: Create persistent volume
  include_tasks: pv.yaml
  when: create_pv

- name: Create standard-user and playground namespace
  include_tasks: standard-user.yaml
  when: standard_user

- name: Post jobs
  include_tasks: post.yaml
