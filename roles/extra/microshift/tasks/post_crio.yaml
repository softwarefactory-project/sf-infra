---
- name: Comment ipv6 value for etc hosts
  become: true
  shell: |
    sed -i '/::1/d' /etc/hosts

- name: Get cri-o version
  shell: |
    rpm -qa --qf '%{VERSION}' cri-o
  register: _crio_version

# NOTE: Alternative config you can find in Sean repo:
# https://github.com/SeanMooney/ard/blob/master/ansible/roles/ensure_microshift/tasks/main.yml#L63-L98
- name: Use only ipv4
  become: true
  get_url:
    url: https://raw.githubusercontent.com/cri-o/cri-o/v{{ _crio_version.stdout }}/contrib/cni/11-crio-ipv4-bridge.conf
    dest: /etc/cni/net.d/100-crio-bridge.conf
    mode: "0644"

- name: Enable containerd
  become: true
  service:
    name: crio
    state: restarted
    enabled: true
