---
- name: Create CRC snapshot log dir
  become: true
  ansible.builtin.file:
    path: "{{ crc_ansible_log_dir }}"
    state: directory
    owner: "{{ ansible_user | default(ansible_user_id) }}"
    group: "{{ ansible_user | default(ansible_user_id) }}"

- name: Configure non extracted CRC script and cronjob
  when: crc_extracted_crc | default(false)
  block:
    - name: Copy script for executing Ansible playbook for CRC image
      become: true
      template:
        src: recreate-crc-snapshot.sh.j2
        dest: /usr/local/bin/recreate-crc-snapshot.sh
        mode: "0755"
        owner: "{{ ansible_user | default(ansible_user_id) }}"
        group: "{{ ansible_user | default(ansible_user_id) }}"

    - name: Create crontab entry for generating weekly CRC image on Wendnesday
      ansible.builtin.cron:
        name: Creating weekly CRC image
        weekday: 4
        hour: 3
        minute: 30
        job: /usr/local/bin/recreate-crc-snapshot.sh

- name: Configure extracted CRC script and cronjob
  when: crc_extracted_crc | default(false)
  block:
    - name: Copy script for executing Ansible playbook for CRC image
      become: true
      template:
        src: recreate-crc-snapshot.sh.j2
        dest: /usr/local/bin/recreate-crc-extracted.sh
        mode: "0755"
        owner: "{{ ansible_user | default(ansible_user_id) }}"
        group: "{{ ansible_user | default(ansible_user_id) }}"

    - name: Create crontab entry for generating weekly CRC extracted image on Wendnesday
      ansible.builtin.cron:
        name: Creating weekly CRC image
        weekday: 4
        hour: 5
        minute: 30
        job: /usr/local/bin/recreate-crc-extracted.sh
